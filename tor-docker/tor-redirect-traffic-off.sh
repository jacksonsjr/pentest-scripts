#!/bin/sh

echo "Set default policies to ACCEPT"
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT

echo "Flushing filter and nat tables"
iptables -F
iptables -t nat -F

if [ -e /etc/resolv.orig ]; then
    echo "Restore resolv.conf to DNS queries..."
    rm -rf /etc/resolv.conf
    mv /etc/resolv.orig /etc/resolv.conf
else
    DNS=$(ip route | grep default | awk '{print $3}')
    echo "Deleting old resolv.conf..."
    rm -rf /etc/resolv.conf
    echo "Setting the correct resolv.conf to DNS queries..."
    echo "search localdomain" > /etc/resolv.conf
    echo "nameserver ${DNS}" >> /etc/resolv.conf
fi
